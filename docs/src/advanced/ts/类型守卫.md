# ç±»å‹å®ˆå«

## ä»€ä¹ˆæ˜¯ç±»å‹å®ˆå« ğŸ›¡ï¸

ç±»å‹å®ˆå«æ˜¯ TypeScript ä¸­çš„ä¸€ä¸ªç‰¹æ€§ï¼Œå®ƒå…è®¸ä½ åœ¨ä½¿ç”¨ç‰¹å®šçš„å˜é‡æˆ–å±æ€§ä¹‹å‰ï¼Œå¯¹å˜é‡çš„ç±»å‹è¿›è¡Œæ›´ç²¾ç¡®çš„æ£€æŸ¥ã€‚è¿™åœ¨å¤„ç†è”åˆç±»å‹æˆ–ä»»ä½•ç±»å‹æ—¶ç‰¹åˆ«æœ‰ç”¨ï¼Œå¯ä»¥ç¼©å°å˜é‡çš„å¯èƒ½ç±»å‹èŒƒå›´ï¼Œä»è€Œæä¾›æ›´å…·ä½“çš„ç±»å‹ä¿¡æ¯ç»™ç¼–è¯‘å™¨ã€‚

ä¾‹å¦‚ ğŸŒ°ï¼š

```ts
function printValue(value: string | number) {
  if (typeof value === "string") {
    console.log(value.toUpperCase()); // å­—ç¬¦ä¸²å¤„ç†
  } else {
    console.log(value.toFixed(2)); // æ•°å­—å¤„ç†
  }
}
```

åœ¨ `if (typeof value === "string")` åˆ†æ”¯ä¸‹ï¼ŒTypeScript ä¼šçŸ¥é“ `value` çš„ç±»å‹æ˜¯ `string`ï¼Œå› æ­¤å¯ä»¥å®‰å…¨åœ°è°ƒç”¨ `toUpperCase` æ–¹æ³•ã€‚åœ¨ `else` åˆ†æ”¯ä¸‹ï¼ŒTypeScript ä¼šçŸ¥é“ `value` çš„ç±»å‹æ˜¯ `number`ï¼Œå› æ­¤å¯ä»¥å®‰å…¨åœ°è°ƒç”¨ `toFixed` æ–¹æ³•ã€‚

## ç±»å‹å®ˆå«çš„ç§ç±»

### typeof ç±»å‹å®ˆå«

`typeof` ç±»å‹å®ˆå«ç”¨äºæ£€æŸ¥å˜é‡çš„ç±»å‹æ˜¯å¦ä¸ºç‰¹å®šçš„åŸå§‹ç±»å‹ï¼Œå¦‚ `string`ã€`number`ã€`boolean` ç­‰ã€‚å®ƒè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºå˜é‡çš„ç±»å‹ã€‚

```ts
function printValue(value: string | number) {
  if (typeof value === "string") {
    console.log(value.toUpperCase()); // å­—ç¬¦ä¸²å¤„ç†
  } else {
    console.log(value.toFixed(2)); // æ•°å­—å¤„ç†
  }
}
```

### instanceof ç±»å‹å®ˆå«

`instanceof` ç±»å‹å®ˆå«ç”¨äºæ£€æŸ¥ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯æŸä¸ªæ„é€ å‡½æ•°çš„å®ä¾‹ã€‚å®ƒè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºå¯¹è±¡æ˜¯å¦æ˜¯æŸä¸ªç±»çš„å®ä¾‹ã€‚

```ts
class Person {
  name: string;
  age: number;
}

class Animal {
  species: string;
}

function printValue(value: Person | Animal) {
  if (value instanceof Person) {
    console.log(value.name); // Person å±æ€§å¤„ç†
  } else {
    console.log(value.species); // Animal å±æ€§å¤„ç†
  }
}
```

### in ç±»å‹å®ˆå«

`in` ç±»å‹å®ˆå«ç”¨äºæ£€æŸ¥ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å…·æœ‰æŸä¸ªå±æ€§ã€‚å®ƒè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºå¯¹è±¡æ˜¯å¦å…·æœ‰è¯¥å±æ€§ã€‚

```ts
interface Person {
  name: string;
  age: number;
}

interface Animal {
  species: string;
}

function printValue(value: Person | Animal) {
  if ("name" in value) {
    console.log(value.name); // Person å±æ€§å¤„ç†
  } else {
    console.log(value.species); // Animal å±æ€§å¤„ç†
  }
}
```

### è‡ªå®šä¹‰ç±»å‹å®ˆå«

åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦å°†åˆ¤æ–­é€»è¾‘å°è£…èµ·æ¥æå–åˆ°å‡½æ•°å¤–éƒ¨è¿›è¡Œå¤ç”¨ï¼Œä¾‹å¦‚ ğŸŒ°ï¼š

```ts
interface Person {
  name: string;
  age: number;
}

interface Animal {
  species: string;
}

function isPerson(value: Person | Animal): boolean {
  return "name" in value;
}

function printValue(value: Person | Animal) {
  if (isPerson(value)) {
    // ç±»å‹â€œPerson | Animalâ€ä¸Šä¸å­˜åœ¨å±æ€§â€œnameâ€ã€‚ç±»å‹â€œAnimalâ€ä¸Šä¸å­˜åœ¨å±æ€§â€œnameâ€ã€‚
    console.log(value.name); // [!code error]
  } else {
    console.log(value.species); // Animal å±æ€§å¤„ç†
  }
}
```

ä¸Šé¢çš„ä»£ç çœ‹èµ·æ¥åªæ˜¯å°†åŸæ¥çš„åˆ¤æ–­æ¡ä»¶æå–åˆ°äº†ä¸€ä¸ªå¤–éƒ¨å‡½æ•°ï¼Œæ‰§è¡Œç»“æœåº”è¯¥å’Œæœªæå–æ—¶ä¸€æ ·ï¼Œå¦‚æœ isPerson è¿”å›äº† trueï¼Œé‚£ value è‚¯å®šä¹Ÿæ˜¯ isPerson ç±»å‹ï¼Œä½†æ˜¯è®©äººç–‘æƒ‘çš„æ˜¯ï¼Œvalue æ— æ³•è¢«æ”¶çª„æˆ Preson ç±»å‹ï¼Œè€Œè¿˜æ˜¯ Person | Animal ç±»å‹ã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ

å› ä¸º isPerson è¿™ä¸ªå‡½æ•°åœ¨å¦å¤–ä¸€ä¸ªåœ°æ–¹ï¼Œå†…éƒ¨çš„åˆ¤æ–­é€»è¾‘å¹¶ä¸åœ¨å‡½æ•° printValue ä¸­ã€‚è¿™é‡Œçš„ç±»å‹æ§åˆ¶æµåˆ†æåšä¸åˆ°è·¨å‡½æ•°ä¸Šä¸‹æ–‡æ¥è¿›è¡Œç±»å‹çš„ä¿¡æ¯æ”¶é›†ï¼ˆä½†åˆ«çš„ç±»å‹è¯­è¨€ä¸­å¯èƒ½æ˜¯æ”¯æŒçš„ï¼‰ã€‚

å®é™…ä¸Šï¼Œå°†åˆ¤æ–­é€»è¾‘å°è£…èµ·æ¥æå–åˆ°å‡½æ•°å¤–éƒ¨è¿›è¡Œå¤ç”¨éå¸¸å¸¸è§ã€‚ä¸ºäº†è§£å†³è¿™ä¸€ç±»å‹æ§åˆ¶æµåˆ†æçš„èƒ½åŠ›ä¸è¶³ï¼Œ TypeScript å¼•å…¥äº† **is å…³é”®å­—**æ¥æ˜¾å¼åœ°æä¾›ç±»å‹ä¿¡æ¯ï¼š

```ts
function isPerson(value: any): value is Person {
  return "name" in value;
}

function printValue(value: Person | Animal) {
  if (isPerson(value)) {
    console.log(value.name); // Person å±æ€§å¤„ç†
  } else {
    console.log(value.species); // Animal å±æ€§å¤„ç†
  }
}
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ`isPerson` å‡½æ•°æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„ç±»å‹å®ˆå«å‡½æ•°ï¼Œç”¨äºæ£€æŸ¥ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯ `Person` ç±»å‹ã€‚å®ƒè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºå¯¹è±¡æ˜¯å¦å…·æœ‰ `name` å±æ€§ã€‚åœ¨ `printValue` å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ `isPerson` å‡½æ•°æ¥ç¼©å°å˜é‡çš„ç±»å‹èŒƒå›´ï¼Œä»è€Œæä¾›æ›´å…·ä½“çš„ç±»å‹ä¿¡æ¯ç»™ç¼–è¯‘å™¨ã€‚

`is string`ï¼Œå³ **is å…³é”®å­— + é¢„æœŸç±»å‹**ï¼Œå³å¦‚æœè¿™ä¸ªå‡½æ•°æˆåŠŸè¿”å›ä¸º trueï¼Œé‚£ä¹ˆ is å…³é”®å­—å‰è¿™ä¸ªå…¥å‚çš„ç±»å‹ï¼Œå°±ä¼š**è¢«è¿™ä¸ªç±»å‹å®ˆå«è°ƒç”¨æ–¹åç»­çš„ç±»å‹æ§åˆ¶æµåˆ†ææ”¶é›†åˆ°**ã€‚

è‡ªå®šä¹‰ç±»å‹å®ˆå«ç±»ä¼¼äºç±»å‹æ–­è¨€ï¼Œå®ƒä¸ä¼šå…³å¿ƒä½ çš„ç±»å‹å’Œå®é™…ç±»å‹çš„åŒºåˆ«ï¼š

```ts
function isPerson(value: any): value is Person {
  return "species" in value;
}
function printValue(value: Person | Animal) {
  if (isPerson(value)) {
    console.log(value.name); // Person å±æ€§å¤„ç†
  } else {
    console.log(value.species); // Animal å±æ€§å¤„ç†
  }
}
```

species æœ¬æ¥æ˜¯ Animal çš„å±æ€§ï¼Œä½†æ˜¯ isPerson è¿”å›äº† trueï¼Œæ‰€ä»¥ value è¢«æ”¶çª„æˆäº† Person ç±»å‹ï¼Œæ‰€ä»¥å¯ä»¥è°ƒç”¨ Person çš„ name å±æ€§ã€‚

### ç±»å‹æ–­è¨€å®ˆå«

ç±»å‹æ–­è¨€å®ˆå«æ˜¯ä¸€ç§ç‰¹æ®Šçš„ç±»å‹å®ˆå«ï¼Œå®ƒä½¿ç”¨ assert å…³é”®å­—æ¥æ˜¾å¼åœ°æä¾›ç±»å‹ä¿¡æ¯ã€‚æ–­è¨€å®ˆå«å’Œç±»å‹å®ˆå«æœ€å¤§çš„ä¸åŒç‚¹åœ¨äºï¼Œåœ¨åˆ¤æ–­æ¡ä»¶ä¸é€šè¿‡æ—¶ï¼Œæ–­è¨€å®ˆå«éœ€è¦æŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œç±»å‹å®ˆå«åªéœ€è¦å‰”é™¤æ‰é¢„æœŸçš„ç±»å‹ã€‚

```ts
function assert(condition: any): asserts condition {
  if (!condition) {
    throw new Error("condition type is error");
  }
}
```

è¿™é‡Œä½¿ç”¨çš„æ˜¯ `asserts condition` ï¼Œè€Œ condition æ¥è‡ªäºå®é™…é€»è¾‘ï¼è¿™ä¹Ÿæ„å‘³ç€ï¼Œæˆ‘ä»¬**å°† condition è¿™ä¸€é€»è¾‘å±‚é¢çš„ä»£ç ï¼Œä½œä¸ºäº†ç±»å‹å±‚é¢çš„åˆ¤æ–­ä¾æ®**ï¼Œç›¸å½“äºåœ¨è¿”å›å€¼ç±»å‹ä¸­ä½¿ç”¨ä¸€ä¸ªé€»è¾‘è¡¨è¾¾å¼è¿›è¡Œäº†ç±»å‹æ ‡æ³¨ã€‚

ä¾‹å¦‚ ğŸŒ°ï¼š

```ts
const a: any = 123;

assert(typeof a === "string");

console.log(a.toUpperCase());
```

a è¢«ä½œä¸º string ç±»å‹ä½¿ç”¨äº† string çš„ toUpperCase æ–¹æ³•ã€‚

é€šè¿‡å’Œ is å…³é”®å­—é…åˆä½¿ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥æ›´çµæ´»åœ°ä½¿ç”¨ç±»å‹å®ˆå«å’Œæ–­è¨€å®ˆå«ï¼š

```ts
let a: any = 1234;

function assertIsString(val: any): asserts val is string {
  if (typeof val !== "string") {
    throw new Error("Not a string!");
  }
}

assertIsString(a);

// string ç±»å‹ï¼
console.log(a.toUpperCase());
```

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ æ— éœ€å†ä¸ºæ–­è¨€å®ˆå«ä¼ å…¥ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œè€Œæ˜¯å¯ä»¥å°†è¿™ä¸ªåˆ¤æ–­ç”¨çš„è¡¨è¾¾å¼æ”¾è¿›æ–­è¨€å®ˆå«çš„å†…éƒ¨ï¼Œæ¥è·å¾—æ›´ç‹¬ç«‹åœ°ä»£ç é€»è¾‘ã€‚
